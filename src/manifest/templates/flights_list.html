{% extends 'base.html' %}

{% block title %}Flights list{% endblock %}

{% block content %}
<form method="get" action="{% url 'flights_list' %}">
    <label for="filter">Filter by date:</label>
    <input id="filter" type="text" value="{{filter}}" name="filter">
    <label for="sort">Sort by column name</label>
    <input id="sort" type="text" value="{{sort}}" name="sort">
    <input type="submit" value="Submit">
</form>

<h1>Flights</h1>
{% if perms.manifest.flight_add %}
<form action="{% url 'add_flight' %}">
    <input type="submit" value="Schedule flight + " />
</form>
{% endif %}
<table border="1" width="50%" cellpadding="4" cellspacing="0" style="background-color:lightblue">
    <tr style="background-color:lightgrey">
        <th>No</th>
        <th>Date</th>
        <th>Available seats</th>
        <th>Status</th>
        <th>Actions</th>
    </tr>
    {% for flight in page_obj %}
    {# Each "flight" is a Flight model object. #}
        <tr style="background-color:lightgrey">
            <td>{{ flight.order_number }}</td>
            <td>{{ flight.date|date:"Y-m-d" }}</td>
            <td>{{ flight.seats_left }}</td>
            <td>{{ flight.status }}</td>
            <td>
                <a href="{% url 'plan_flight' flight.id %}">PLAN</a>
            </td>
        </tr>
        {% if flight.ticket_set.all|length > 0 %}
        <tr >
            <td rowspan={{ flight.ticket_set.all|length|add:1 }}>Tickets</td>
            <th>Name</th>
            <th>Parachute</th>
            <th>Exit height</th>
            <th>Price</th>
        </tr>
        {% for ticket in flight.ticket_set.all %}
            <tr >
                <td>{{ ticket.bought_by.profile }}</td>
                <td>{{ ticket.luggage }}</td>
                <td>{{ ticket.exit_height }}</td>
                <td>{{ ticket.price }}</td>
            </tr>
        {% endfor %}
        {% endif %}
{% endfor %}
</table>


<div class="pagination">
    <span class="step-links">
        {% if page_obj.has_previous %}
            <a href="?page=1">&laquo; first</a>
            <a href="?page={{ page_obj.previous_page_number }}">previous</a>
        {% endif %}

        <span class="current">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
        </span>

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}">next</a>
            <a href="?page={{ page_obj.paginator.num_pages }}">last &raquo;</a>
        {% endif %}
    </span>
</div>
{% endblock %}